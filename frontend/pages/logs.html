<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>システムログ - ChatBot Admin</title>
    <link rel="stylesheet" href="../assets/css/pages/admin_dashboard.css">
    <link rel="stylesheet" href="../assets/css/pages/admin_users.css"> <link rel="stylesheet" href="../assets/css/pages/admin_logs.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <header class="admin-header">
        <div class="header-logo">ChatBot Admin / システムログ</div>
        <div class="header-actions">
            <span class="user-name">管理者 様</span>
            <a href="./index.html" class="header-link">← 管理メニューへ</a>
        </div>
    </header>

    <div class="dashboard-container">
        <div class="page-title">
            <h1>System Logs</h1>
            <div class="actions">
                <button class="btn-secondary"><i class="fa-solid fa-download"></i> CSVエクスポート</button>
            </div>
        </div>

        <div class="card filter-card">
            <form class="filter-bar log-filter-bar">
                <div class="filter-row">
                    <div class="filter-item">
                        <label>期間 (From - To)</label>
                        <div class="date-range-group">
                            <input type="datetime-local" class="date-input">
                            <span class="separator">~</span>
                            <input type="datetime-local" class="date-input">
                        </div>
                    </div>
                    <div class="filter-item">
                        <label>ログ種別</label>
                        <select>
                            <option value="">全て</option>
                            <option value="system">System</option>
                            <option value="auth">Auth</option>
                            <option value="rag">RAG</option>
                            <option value="user">User Action</option>
                        </select>
                    </div>
                    <div class="filter-item">
                        <label>レベル</label>
                        <select>
                            <option value="">全て</option>
                            <option value="info">INFO</option>
                            <option value="warn">WARN</option>
                            <option value="error">ERROR</option>
                        </select>
                    </div>
                </div>
                
                <div class="filter-row">
                    <div class="filter-item search-box-wide">
                        <label>キーワード / ユーザー / エラー内容</label>
                        <div class="input-icon-wrapper">
                            <i class="fa-solid fa-magnifying-glass"></i>
                            <input type="text" placeholder="検索ワードを入力...">
                        </div>
                    </div>
                    <div class="filter-item actions">
                        <label>&nbsp;</label>
                        <button type="button" class="btn-secondary">検索</button>
                    </div>
                </div>
            </form>
        </div>

        <div class="card table-card">
            <table class="data-table log-table">
                <thead>
                    <tr>
                        <th width="18%">日時</th>
                        <th width="8%">レベル</th>
                        <th width="10%">種別</th>
                        <th width="12%">操作/API</th>
                        <th width="35%">メッセージ</th>
                        <th width="12%">ユーザー</th>
                        <th width="5%"></th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="log-row row-error" onclick="openLogDetail(1)">
                        <td class="font-mono">2026-02-09 11:45:22</td>
                        <td><span class="badge badge-error">ERROR</span></td>
                        <td>System</td>
                        <td>DB_CONNECTION</td>
                        <td class="text-truncate">Connection timeout: failed to connect to psql:5432...</td>
                        <td>system</td>
                        <td class="text-center"><i class="fa-solid fa-chevron-right"></i></td>
                    </tr>
                    <tr class="log-row row-warn" onclick="openLogDetail(2)">
                        <td class="font-mono">2026-02-09 11:30:05</td>
                        <td><span class="badge badge-warn">WARN</span></td>
                        <td>RAG</td>
                        <td>Generate</td>
                        <td class="text-truncate">Low confidence score (0.45) for query "xyz"...</td>
                        <td>taro.yamada</td>
                        <td class="text-center"><i class="fa-solid fa-chevron-right"></i></td>
                    </tr>
                    <tr class="log-row" onclick="openLogDetail(3)">
                        <td class="font-mono">2026-02-09 11:28:10</td>
                        <td><span class="badge badge-info">INFO</span></td>
                        <td>Auth</td>
                        <td>Login</td>
                        <td class="text-truncate">User logged in successfully from IP 192.168.1.1</td>
                        <td>taro.yamada</td>
                        <td class="text-center"><i class="fa-solid fa-chevron-right"></i></td>
                    </tr>
                </tbody>
            </table>
            
            <div class="pagination">
                <button disabled>&laquo;</button>
                <button class="active">1</button>
                <button>2</button>
                <button>&raquo;</button>
            </div>
        </div>
    </div>

    <div id="log-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content modal-lg"> <div class="modal-header">
                <h3>ログ詳細 <span class="log-id">#LOG-12345</span></h3>
                <button class="close-modal">×</button>
            </div>
            <div class="modal-body">
                <div class="log-meta-grid">
                    <div class="meta-item">
                        <label>日時</label>
                        <div class="font-mono">2026-02-09 11:45:22</div>
                    </div>
                    <div class="meta-item">
                        <label>レベル</label>
                        <div><span class="badge badge-error">ERROR</span></div>
                    </div>
                    <div class="meta-item">
                        <label>種別</label>
                        <div>System / DB_CONNECTION</div>
                    </div>
                    <div class="meta-item">
                        <label>ユーザー</label>
                        <div>system (Batch Process)</div>
                    </div>
                </div>

                <div class="log-section">
                    <h4>メッセージ</h4>
                    <p class="log-message-box">
                        Connection timeout: failed to connect to psql:5432 within 5000ms.
                    </p>
                </div>

                <div class="log-section">
                    <h4>スタックトレース / 詳細データ</h4>
                    <pre class="code-block"><code>Error: Connection timeout
    at Client.connect (/app/node_modules/pg/lib/client.js:52:11)
    at ConnectionParameters.connect (/app/node_modules/pg/lib/connection.js:10:20)
    at Object.<anonymous> (/app/src/config/db.js:15:5)
    ...</code></pre>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn-secondary close-modal-btn">閉じる</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        function openLogDetail(id) {
            document.getElementById('log-modal').style.display = 'flex';
        }
        document.querySelectorAll('.close-modal, .close-modal-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.getElementById('log-modal').style.display = 'none';
            });
        });
    </script>
</body>
</html>